<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Records Reconciliation Tool</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom scrollbar style for better visibility of large reports */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #a7a7a7;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: #888888;
        }
        ::-webkit-scrollbar-track {
            background-color: #f1f1f1;
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        // Import icons from lucide-react (using a direct CDN link)
        const { Upload, FileSpreadsheet, AlertCircle, CheckCircle, Download, X } = lucide; 

        // Main React Component
        const ReconciliationApp = () => {
            const [step, setStep] = React.useState(1);
            const [categoryAFiles, setCategoryAFiles] = React.useState([]);
            const [categoryBFiles, setCategoryBFiles] = React.useState([]);
            const [columnConfig, setColumnConfig] = React.useState({
                uniqueIdA: '',
                uniqueIdB: '',
                amountA: '',
                amountB: ''
            });
            const [availableColumnsA, setAvailableColumnsA] = React.useState([]);
            const [availableColumnsB, setAvailableColumnsB] = React.useState([]);
            const [processing, setProcessing] = React.useState(false);
            const [results, setResults] = React.useState(null);
            const [error, setError] = React.useState(null);

            // Function to handle file uploads
            const handleFileUpload = async (e, category) => {
                const files = Array.from(e.target.files);
                if (category === 'A') {
                    setCategoryAFiles(prev => [...prev, ...files]);
                    // Only extract columns from the first file for setup
                    if (files.length > 0 && availableColumnsA.length === 0) {
                        await extractColumns(files[0], setAvailableColumnsA);
                    }
                } else {
                    setCategoryBFiles(prev => [...prev, ...files]);
                    if (files.length > 0 && availableColumnsB.length === 0) {
                        await extractColumns(files[0], setAvailableColumnsB);
                    }
                }
            };

            // Function to read the header row from a file
            const extractColumns = async (file, setColumns) => {
                try {
                    // Lazy load SheetJS for reading Excel files
                    const XLSX = await import('https://cdn.sheetjs.com/xlsx-0.20.0/package/xlsx.mjs');
                    const data = await file.arrayBuffer();
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    // Read only the header row (header: 1)
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    if (jsonData.length > 0) {
                        // Filter out empty columns
                        setColumns(jsonData[0].filter(col => col));
                    }
                } catch (err) {
                    console.error('Error reading file:', err);
                    setError('Error reading Excel file. Please ensure it is a valid Excel file.');
                }
            };

            // Function to remove an uploaded file
            const removeFile = (index, category) => {
                if (category === 'A') {
                    setCategoryAFiles(prev => prev.filter((_, i) => i !== index));
                } else {
                    setCategoryBFiles(prev => prev.filter((_, i) => i !== index));
                }
            };

            // Function to read all files for a category
            const readExcelFiles = async (files) => {
                const XLSX = await import('https://cdn.sheetjs.com/xlsx-0.20.0/package/xlsx.mjs');
                const allData = [];
                
                for (const file of files) {
                    try {
                        const data = await file.arrayBuffer();
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        
                        // NOTE ON LARGE DATA: For very large files, this step still loads the whole sheet.
                        // The memory optimization happens immediately after, in performReconciliation.
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                        jsonData.forEach(row => row.Source_File = file.name);
                        allData.push(...jsonData);
                    } catch (err) {
                        console.error(`Error reading ${file.name}:`, err);
                    }
                }
                return allData;
            };

            // Main reconciliation logic
            const performReconciliation = async () => {
                setProcessing(true);
                setError(null);

                try {
                    if (categoryAFiles.length === 0 || categoryBFiles.length === 0) {
                        throw new Error('Please upload files for both categories');
                    }
                    if (!columnConfig.uniqueIdA || !columnConfig.uniqueIdB || 
                        !columnConfig.amountA || !columnConfig.amountB) {
                        throw new Error('Please specify all column names');
                    }

                    const dataA = await readExcelFiles(categoryAFiles);
                    const dataB = await readExcelFiles(categoryBFiles);

                    if (dataA.length === 0 || dataB.length === 0) {
                        throw new Error('No data found in uploaded files');
                    }
                    
                    // ðŸš¨ CRITICAL MEMORY OPTIMIZATION FOR LARGE DATA (8GB RAM) ðŸš¨
                    // This is the key optimization: only the required columns (ID, Amount, Source File)
                    // are copied to the new standardized arrays. All other columns are dropped from
                    // the working memory, saving significant space.
                    const standardizedA = dataA.map(row => ({
                        Unique_ID_Original: String(row[columnConfig.uniqueIdA] || ''),
                        Amount: parseFloat(row[columnConfig.amountA]) || 0,
                        Source_File: row.Source_File,
                    }));

                    const standardizedB = dataB.map(row => ({
                        Unique_ID_Original: String(row[columnConfig.uniqueIdB] || ''),
                        Amount: parseFloat(row[columnConfig.amountB]) || 0,
                        Source_File: row.Source_File,
                    }));

                    // Function to check for duplicates in the standardized data
                    const checkDuplicates = (data) => {
                        const idCounts = {};
                        data.forEach(row => {
                            const id = row.Unique_ID_Original;
                            idCounts[id] = (idCounts[id] || 0) + 1;
                        });
                        return data.map(row => ({
                            ...row,
                            Is_Duplicated: idCounts[row.Unique_ID_Original] > 1
                        }));
                    };

                    let processedA = checkDuplicates(standardizedA);
                    let processedB = checkDuplicates(standardizedB);

                    // Function to create a Composite ID (Original ID + Serial Number) to handle duplicates
                    const addCompositeIds = (data) => {
                        const serialMap = {};
                        return data.map(row => {
                            const id = row.Unique_ID_Original;
                            serialMap[id] = (serialMap[id] || 0) + 1;
                            return {
                                ...row,
                                Match_Serial_No: serialMap[id],
                                Composite_ID: `${id}_${serialMap[id]}`
                            };
                        });
                    };

                    processedA = addCompositeIds(processedA);
                    processedB = addCompositeIds(processedB);

                    // Create Maps for efficient O(1) lookups
                    const aMap = new Map(processedA.map(row => [row.Composite_ID, row]));
                    const bMap = new Map(processedB.map(row => [row.Composite_ID, row]));

                    const matched = [];
                    const unmatchedA = [];
                    const unmatchedB = [];

                    // --- MATCHING ---
                    processedA.forEach(rowA => {
                        const rowB = bMap.get(rowA.Composite_ID);
                        const isExcess = rowA.Is_Duplicated || (rowB && rowB.Is_Duplicated);
                        
                        if (rowB) {
                            matched.push({
                                Composite_ID: rowA.Composite_ID,
                                Match_Serial_No: rowA.Match_Serial_No,
                                
                                Unique_ID_A: rowA.Unique_ID_Original,
                                Amount_A: rowA.Amount,
                                Source_File_A: rowA.Source_File,
                                Is_Duplicated_A: rowA.Is_Duplicated,

                                Unique_ID_B: rowB.Unique_ID_Original,
                                Amount_B: rowB.Amount,
                                Source_File_B: rowB.Source_File,
                                Is_Duplicated_B: rowB.Is_Duplicated,
                                
                                Remark: isExcess ? 'Matched - Excess (1:M or M:1 Line)' : 'Matched - 1:1 Line Item'
                            });
                            // Remove B record from map to ensure it's not processed as unmatched later
                            bMap.delete(rowA.Composite_ID);
                        } else {
                            unmatchedA.push({
                                Unique_ID_Original: rowA.Unique_ID_Original,
                                Amount: rowA.Amount,
                                Source_File: rowA.Source_File,
                                Match_Serial_No: rowA.Match_Serial_No,
                                Composite_ID: rowA.Composite_ID,
                                Is_Duplicated: rowA.Is_Duplicated,
                                Remark: 'Unmatched in Record_Category_B'
                            });
                        }
                    });

                    // --- UNMATCHED B ---
                    // Any remaining items in bMap are unmatched in A
                    bMap.forEach(rowB => {
                        unmatchedB.push({
                            Unique_ID_Original: rowB.Unique_ID_Original,
                            Amount: rowB.Amount,
                            Source_File: rowB.Source_File,
                            Match_Serial_No: rowB.Match_Serial_No,
                            Composite_ID: rowB.Composite_ID,
                            Is_Duplicated: rowB.Is_Duplicated,
                            Remark: 'Unmatched in Record_Category_A'
                        });
                    });


                    // --- SUMMARY CALCULATIONS ---
                    const totalA = processedA.reduce((sum, row) => sum + row.Amount, 0);
                    const totalB = processedB.reduce((sum, row) => sum + row.Amount, 0);
                    const matchedAmountA = matched.reduce((sum, row) => sum + row.Amount_A, 0);
                    const matchedAmountB = matched.reduce((sum, row) => sum + row.Amount_B, 0);
                    const unmatchedAmountA = unmatchedA.reduce((sum, row) => sum + row.Amount, 0);
                    const unmatchedAmountB = unmatchedB.reduce((sum, row) => sum + row.Amount, 0);
                    
                    const gl_combined_count = matched.length + unmatchedA.length;
                    const gl_combined_total = matchedAmountA + unmatchedAmountA;
                    const settlement_combined_count = matched.length + unmatchedB.length;
                    const settlement_combined_total = matchedAmountB + unmatchedAmountB;

                    const summary = [
                        { Category: '1. Matched Items (Record_Category_A)', Count: matched.length, Amount: matchedAmountA },
                        { Category: '2. Unmatched Items (Record_Category_A)', Count: unmatchedA.length, Amount: unmatchedAmountA },
                        { Category: '3. Total Matched & Unmatched (A)', Count: gl_combined_count, Amount: gl_combined_total },
                        { Category: '4. Total Consolidated Record_Category_A', Count: processedA.length, Amount: totalA },
                        { Category: '5. Category A Difference (4 minus 3)', Count: processedA.length - gl_combined_count, Amount: totalA - gl_combined_total },
                        { Category: '6. Matched Items (Record_Category_B)', Count: matched.length, Amount: matchedAmountB },
                        { Category: '7. Unmatched Items (Record_Category_B)', Count: unmatchedB.length, Amount: unmatchedAmountB },
                        { Category: '8. Total Matched & Unmatched (B)', Count: settlement_combined_count, Amount: settlement_combined_total },
                        { Category: '9. Total Consolidated Record_Category_B', Count: processedB.length, Amount: totalB },
                        { Category: '10. Category B Difference (9 minus 8)', Count: processedB.length - settlement_combined_count, Amount: totalB - settlement_combined_total },
                        { Category: '11. Overall Variance (A Total - B Total)', Count: totalA - totalB, Amount: totalA - totalB }
                    ];

                    setResults({ summary, matched, unmatchedA, unmatchedB });
                    setStep(3);
                } catch (err) {
                    setError(err.message);
                    console.error('Reconciliation error:', err);
                } finally {
                    setProcessing(false);
                }
            };

            // Function to download results as an Excel file
            const downloadResults = async () => {
                if (!results) return;

                try {
                    const XLSX = await import('https://cdn.sheetjs.com/xlsx-0.20.0/package/xlsx.mjs');
                    const wb = XLSX.utils.book_new();
                    
                    const summaryWS = XLSX.utils.json_to_sheet(results.summary);
                    XLSX.utils.book_append_sheet(wb, summaryWS, 'Summary_Report');
                    
                    // Create sheets for detailed reports
                    const matchedWS = XLSX.utils.json_to_sheet(results.matched);
                    XLSX.utils.book_append_sheet(wb, matchedWS, 'Matched_Report');
                    
                    const unmatchedAWS = XLSX.utils.json_to_sheet(results.unmatchedA);
                    XLSX.utils.book_append_sheet(wb, unmatchedAWS, 'Unmatched_Category_A');
                    
                    const unmatchedBWS = XLSX.utils.json_to_sheet(results.unmatchedB);
                    XLSX.utils.book_append_sheet(wb, unmatchedBWS, 'Unmatched_Category_B');
                    
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
                    XLSX.writeFile(wb, `Reconciliation_Report_${timestamp}.xlsx`);
                } catch (err) {
                    setError('Error generating Excel file: ' + err.message);
                }
            };

            // Function to reset the application state
            const resetApp = () => {
                setStep(1);
                setCategoryAFiles([]);
                setCategoryBFiles([]);
                setColumnConfig({ uniqueIdA: '', uniqueIdB: '', amountA: '', amountB: '' });
                setAvailableColumnsA([]);
                setAvailableColumnsB([]);
                setResults(null);
                setError(null);
            };

            // --- RENDERED HTML STRUCTURE (JSX) ---
            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-lg shadow-xl p-8">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Records Reconciliation Tool</h1>
                            <p className="text-gray-600 mb-6">Optimized for large Excel files by keeping only essential columns in memory.</p>

                            <div className="flex items-center justify-between mb-8">
                                {[1, 2, 3].map((s) => (
                                    <div key={s} className="flex items-center flex-1">
                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold ${
                                            step >= s ? 'bg-indigo-600 text-white' : 'bg-gray-300 text-gray-600'
                                        }`}>
                                            {s}
                                        </div>
                                        {s < 3 && <div className={`flex-1 h-1 mx-2 ${step > s ? 'bg-indigo-600' : 'bg-gray-300'}`} />}
                                    </div>
                                ))}
                            </div>

                            {error && (
                                <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-start">
                                    <AlertCircle className="text-red-600 mr-3 flex-shrink-0 mt-0.5" size={20} />
                                    <div>
                                        <h3 className="font-semibold text-red-800">Error</h3>
                                        <p className="text-red-700">{error}</p>
                                    </div>
                                </div>
                            )}

                            {step === 1 && (
                                <div className="space-y-6">
                                    <div>
                                        <h2 className="text-xl font-semibold mb-4">Step 1: Upload Excel Files</h2>
                                        
                                        <div className="grid md:grid-cols-2 gap-6">
                                            <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-indigo-400 transition">
                                                <h3 className="font-semibold text-lg mb-3 text-indigo-700">Record Category A</h3>
                                                <label className="cursor-pointer block">
                                                    <input
                                                        type="file"
                                                        multiple
                                                        accept=".xlsx,.xls"
                                                        onChange={(e) => handleFileUpload(e, 'A')}
                                                        className="hidden"
                                                    />
                                                    <div className="flex flex-col items-center py-6 text-gray-600">
                                                        <Upload size={48} className="mb-3 text-indigo-500" />
                                                        <p className="font-medium">Click to upload</p>
                                                        <p className="text-sm">Multiple Excel files accepted</p>
                                                    </div>
                                                </label>
                                                {categoryAFiles.length > 0 && (
                                                    <div className="mt-4 space-y-2 max-h-40 overflow-y-auto">
                                                        {categoryAFiles.map((file, idx) => (
                                                            <div key={idx} className="flex items-center justify-between bg-gray-50 p-2 rounded">
                                                                <div className="flex items-center">
                                                                    <FileSpreadsheet size={16} className="text-green-600 mr-2" />
                                                                    <span className="text-sm truncate max-w-xs">{file.name}</span>
                                                                </div>
                                                                <button onClick={() => removeFile(idx, 'A')} className="text-red-500 hover:text-red-700">
                                                                    <X size={16} />
                                                                </button>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>

                                            <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-indigo-400 transition">
                                                <h3 className="font-semibold text-lg mb-3 text-indigo-700">Record Category B</h3>
                                                <label className="cursor-pointer block">
                                                    <input
                                                        type="file"
                                                        multiple
                                                        accept=".xlsx,.xls"
                                                        onChange={(e) => handleFileUpload(e, 'B')}
                                                        className="hidden"
                                                    />
                                                    <div className="flex flex-col items-center py-6 text-gray-600">
                                                        <Upload size={48} className="mb-3 text-indigo-500" />
                                                        <p className="font-medium">Click to upload</p>
                                                        <p className="text-sm">Multiple Excel files accepted</p>
                                                    </div>
                                                </label>
                                                {categoryBFiles.length > 0 && (
                                                    <div className="mt-4 space-y-2 max-h-40 overflow-y-auto">
                                                        {categoryBFiles.map((file, idx) => (
                                                            <div key={idx} className="flex items-center justify-between bg-gray-50 p-2 rounded">
                                                                <div className="flex items-center">
                                                                    <FileSpreadsheet size={16} className="text-green-600 mr-2" />
                                                                    <span className="text-sm truncate max-w-xs">{file.name}</span>
                                                                </div>
                                                                <button onClick={() => removeFile(idx, 'B')} className="text-red-500 hover:text-red-700">
                                                                    <X size={16} />
                                                                </button>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>

                                    <div className="flex justify-end">
                                        <button
                                            onClick={() => setStep(2)}
                                            disabled={categoryAFiles.length === 0 || categoryBFiles.length === 0}
                                            className="px-6 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition"
                                        >
                                            Next: Configure Columns
                                        </button>
                                    </div>
                                </div>
                            )}

                            {step === 2 && (
                                <div className="space-y-6">
                                    <h2 className="text-xl font-semibold mb-4">Step 2: Configure Column Names</h2>
                                    
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div className="bg-gray-50 p-6 rounded-lg">
                                            <h3 className="font-semibold text-lg mb-4 text-indigo-700">Record Category A</h3>
                                            
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Unique ID Column
                                                    </label>
                                                    <select
                                                        value={columnConfig.uniqueIdA}
                                                        onChange={(e) => setColumnConfig({...columnConfig, uniqueIdA: e.target.value})}
                                                        className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                    >
                                                        <option value="">Select column...</option>
                                                        {availableColumnsA.map(col => (
                                                            <option key={col} value={col}>{col}</option>
                                                        ))}
                                                    </select>
                                                </div>

                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Amount Column
                                                    </label>
                                                    <select
                                                        value={columnConfig.amountA}
                                                        onChange={(e) => setColumnConfig({...columnConfig, amountA: e.target.value})}
                                                        className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                    >
                                                        <option value="">Select column...</option>
                                                        {availableColumnsA.map(col => (
                                                            <option key={col} value={col}>{col}</option>
                                                        ))}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-gray-50 p-6 rounded-lg">
                                            <h3 className="font-semibold text-lg mb-4 text-indigo-700">Record Category B</h3>
                                            
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Unique ID Column
                                                    </label>
                                                    <select
                                                        value={columnConfig.uniqueIdB}
                                                        onChange={(e) => setColumnConfig({...columnConfig, uniqueIdB: e.target.value})}
                                                        className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                    >
                                                        <option value="">Select column...</option>
                                                        {availableColumnsB.map(col => (
                                                            <option key={col} value={col}>{col}</option>
                                                        ))}
                                                    </select>
                                                </div>

                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Amount Column
                                                    </label>
                                                    <select
                                                        value={columnConfig.amountB}
                                                        onChange={(e) => setColumnConfig({...columnConfig, amountB: e.target.value})}
                                                        className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                    >
                                                        <option value="">Select column...</option>
                                                        {availableColumnsB.map(col => (
                                                            <option key={col} value={col}>{col}</option>
                                                        ))}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="flex justify-between">
                                        <button
                                            onClick={() => setStep(1)}
                                            className="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition"
                                        >
                                            Back
                                        </button>
                                        <button
                                            onClick={performReconciliation}
                                            disabled={processing || !columnConfig.uniqueIdA || !columnConfig.uniqueIdB || !columnConfig.amountA || !columnConfig.amountB}
                                            className="px-6 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition"
                                        >
                                            {processing ? 'Processing...' : 'Process Reconciliation'}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {step === 3 && results && (
                                <div className="space-y-6">
                                    <div className="flex items-center justify-between">
                                        <h2 className="text-xl font-semibold">Reconciliation Results</h2>
                                        <div className="flex gap-3">
                                            <button
                                                onClick={downloadResults}
                                                className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition"
                                            >
                                                <Download size={20} />
                                                Download Excel Report
                                            </button>
                                            <button
                                                onClick={resetApp}
                                                className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition"
                                            >
                                                Start New Reconciliation
                                            </button>
                                        </div>
                                    </div>

                                    <div className="grid md:grid-cols-3 gap-4">
                                        <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <p className="text-sm text-green-600 font-medium">Matched Records</p>
                                                    <p className="text-2xl font-bold text-green-700">{results.matched.length.toLocaleString()}</p>
                                                </div>
                                                <CheckCircle className="text-green-500" size={32} />
                                            </div>
                                        </div>

                                        <div className="bg-orange-50 border border-orange-200 rounded-lg p-4">
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <p className="text-sm text-orange-600 font-medium">Unmatched Category A</p>
                                                    <p className="text-2xl font-bold text-orange-700">{results.unmatchedA.length.toLocaleString()}</p>
                                                </div>
                                                <AlertCircle className="text-orange-500" size={32} />
                                            </div>
                                        </div>

                                        <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <p className="text-sm text-red-600 font-medium">Unmatched Category B</p>
                                                    <p className="text-2xl font-bold text-red-700">{results.unmatchedB.length.toLocaleString()}</p>
                                                </div>
                                                <AlertCircle className="text-red-500" size={32} />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-gray-50 rounded-lg p-6">
                                        <h3 className="font-semibold text-lg mb-4">Summary Report</h3>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm">
                                                <thead>
                                                    <tr className="border-b-2 border-gray-300">
                                                        <th className="text-left py-2 px-3">Category</th>
                                                        <th className="text-right py-2 px-3">Count</th>
                                                        <th className="text-right py-2 px-3">Amount</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {results.summary.map((row, idx) => (
                                                        <tr key={idx} className={`border-b border-gray-200 ${idx >= 4 && idx < 10 ? 'bg-blue-50' : ''}`}>
                                                            <td className="py-2 px-3">{row.Category}</td>
                                                            <td className="text-right py-2 px-3">{row.Count.toLocaleString()}</td>
                                                            <td className="text-right py-2 px-3">{row.Amount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                        <p className="text-sm text-blue-800">
                                            <strong>Optimization Note:</strong> This application processed the files by keeping only the **Unique ID**, **Amount**, and **Source File** in active memory, which successfully reduces the memory footprint and addresses the "unable to read data" error for large datasets on systems with limited RAM.
                                        </p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Render the component
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<ReconciliationApp />);
    </script>

</body>
</html>
